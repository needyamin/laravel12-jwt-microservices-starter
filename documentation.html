<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel 12 JWT Microservices - Complete Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        nav {
            background: #2d3748;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        nav a:hover {
            background: rgba(255,255,255,0.1);
        }
        
        nav a.active {
            background: rgba(102, 126, 234, 0.8);
            color: white;
            font-weight: 600;
        }
        
        .content {
            padding: 2rem;
        }
        
        section {
            margin-bottom: 4rem;
            scroll-margin-top: 80px;
        }
        
        section h1 {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #667eea;
        }
        
        section h2 {
            font-size: 2rem;
            color: #4a5568;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        
        section h3 {
            font-size: 1.5rem;
            color: #718096;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        
        section h4 {
            font-size: 1.25rem;
            color: #a0aec0;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        
        blockquote {
            border-left: 4px solid #667eea;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #718096;
            font-style: italic;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .badge-info {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .badge-warning {
            background: #feebc8;
            color: #7c2d12;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        
        .alert-info {
            background: #bee3f8;
            color: #2c5282;
            border-left: 4px solid #3182ce;
        }
        
        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #38a169;
        }
        
        .alert-warning {
            background: #feebc8;
            color: #7c2d12;
            border-left: 4px solid #dd6b20;
        }
        
        footer {
            background: #2d3748;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
        }
        
        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            section h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Laravel 12 JWT Microservices</h1>
            <p>Complete Documentation & Architecture Guide</p>
        </header>
        
        <nav>
            <ul>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#api">API Endpoints</a></li>
                <li><a href="#frontend">Frontend</a></li>
                <li><a href="#structure">Structure Improvements</a></li>
                <li><a href="#kafka">Apache Kafka</a></li>
                <li><a href="#environment">Environment Configuration</a></li>
                <li><a href="#services">Adding Services</a></li>
            </ul>
        </nav>
        
        <div class="content">
            <!-- Architecture Section -->
            <section id="architecture">
                <h1>Microservices Architecture</h1>
                
                <h2>Overview</h2>
                <p>This microservices architecture is designed with <strong>scalability</strong> and <strong>ease of extension</strong> in mind. The gateway service acts as a central entry point that routes requests to appropriate microservices based on configuration.</p>
                
                <h2>Architecture Components</h2>
                
                <h3>1. Gateway Service</h3>
                <p>The gateway service is the single entry point for all client requests. It handles:</p>
                <ul>
                    <li><strong>Request Routing</strong>: Routes requests to appropriate microservices</li>
                    <li><strong>JWT Authentication</strong>: Validates JWT tokens before forwarding requests</li>
                    <li><strong>Role-Based Access Control</strong>: Enforces role-based permissions</li>
                    <li><strong>Health Monitoring</strong>: Monitors all registered services</li>
                    <li><strong>Service Discovery</strong>: Dynamically discovers services from configuration</li>
                </ul>
                
                <h4>Key Files</h4>
                <ul>
                    <li><code>app/Services/ServiceRegistry.php</code> - Service registry and discovery</li>
                    <li><code>app/Services/RouteConfig.php</code> - Dynamic route registration</li>
                    <li><code>app/Services/ProxyService.php</code> - Request forwarding logic</li>
                    <li><code>app/Http/Controllers/GatewayController.php</code> - Main gateway controller</li>
                    <li><code>config/services.php</code> - Service configuration (add new services here!)</li>
                </ul>
                
                <h3>2. Microservices</h3>
                <p>Each microservice is an independent Laravel application that:</p>
                <ul>
                    <li>Handles its own domain logic</li>
                    <li>Maintains its own database</li>
                    <li>Exposes RESTful APIs</li>
                    <li>Implements <code>TrustGateway</code> middleware for gateway integration</li>
                </ul>
                
                <h4>Current Services</h4>
                <ul>
                    <li><strong>Users Service</strong> (Port 8001): User management and JWT authentication</li>
                    <li><strong>Orders Service</strong> (Port 8002): Order management</li>
                    <li><strong>Products Service</strong> (Port 8003): Product catalog management</li>
                    <li><strong>Carts Service</strong> (Port 8004): Shopping cart management</li>
                    <li><strong>Payments Service</strong> (Port 8005): Payment processing</li>
                </ul>
                
                <h2>Service Registration System</h2>
                
                <h3>Configuration-Driven Architecture</h3>
                <p>Services are registered through configuration files, not code. This makes adding new services as simple as adding a configuration entry.</p>
                
                <h3>Service Registry</h3>
                <p>The <code>ServiceRegistry</code> class provides a centralized way to:</p>
                <ul>
                    <li>Get all registered services</li>
                    <li>Get service configuration</li>
                    <li>Check if a service exists</li>
                    <li>Get service URLs and routes</li>
                    <li>Register services dynamically</li>
                </ul>
                
                <h3>Route Configuration</h3>
                <p>Routes are automatically registered from service configurations. Each route definition includes:</p>
                <ul>
                    <li><strong>Gateway Path</strong>: The path clients use to access the service</li>
                    <li><strong>Service Path</strong>: The actual path on the target service</li>
                    <li><strong>HTTP Methods</strong>: Allowed methods (GET, POST, PUT, DELETE, etc.)</li>
                    <li><strong>Middleware</strong>: Middleware to apply (authentication, roles, etc.)</li>
                </ul>
                
                <h2>Adding New Services</h2>
                
                <h3>Step 1: Add Service Configuration</h3>
                <p>Edit <code>gateway-service/config/services.php</code>:</p>
                <pre><code>'new-service' => [
    'url' => env('NEW_SERVICE_URL', 'http://localhost:8003'),
    'health_endpoint' => '/api/health',
    'description' => 'New service description',
    'routes' => [
        // Define your routes here
    ],
],</code></pre>
                
                <h3>Step 2: Set Environment Variable</h3>
                <p>For Docker: Add to <code>docker/docker-compose.yml</code> environment section, or add to <code>docker/.env</code>:</p>
                <pre><code># In docker/docker-compose.yml
environment:
  - NEW_SERVICE_URL=http://new-service:8003

# Or in docker/.env
NEW_SERVICE_URL=http://localhost:8003</code></pre>
                <p>For local development: Add to <code>gateway-service/.env</code>:</p>
                <pre><code>NEW_SERVICE_URL=http://localhost:8003</code></pre>
                
                <h3>Step 3: Done!</h3>
                <p>The gateway automatically:</p>
                <ul>
                    <li>Registers all routes</li>
                    <li>Includes the service in health checks</li>
                    <li>Enables dynamic routing</li>
                </ul>
                
                <h2>Request Flow</h2>
                <pre><code>Client Request
    ‚Üì
Gateway Service (Port 8000)
    ‚îú‚îÄ JWT Validation (if required)
    ‚îú‚îÄ Role Check (if required)
    ‚îú‚îÄ Service Lookup
    ‚îî‚îÄ Request Forwarding
         ‚Üì
Target Microservice
    ‚îú‚îÄ TrustGateway Middleware
    ‚îú‚îÄ Business Logic
    ‚îú‚îÄ Kafka Event Publishing (async)
    ‚îî‚îÄ Response
         ‚Üì
Gateway Service
    ‚îî‚îÄ Response to Client

Parallel: Kafka Events
    ‚îú‚îÄ orders.created
    ‚îú‚îÄ orders.updated
    ‚îî‚îÄ services.heartbeat</code></pre>
                
                <h2>Service Communication</h2>
                
                <h3>Gateway ‚Üí Service (HTTP)</h3>
                <p>The gateway forwards requests with these headers:</p>
                <ul>
                    <li><code>X-User-Id</code>: Authenticated user ID</li>
                    <li><code>X-User-Email</code>: Authenticated user email</li>
                    <li><code>X-User-Role</code>: User role</li>
                    <li><code>X-Bypass-Mode</code>: Bypass mode indicator (development)</li>
                </ul>
                
                <h3>Service ‚Üí Gateway (HTTP)</h3>
                <p>Services respond with standard HTTP responses that the gateway forwards to clients.</p>
                
                <h3>Service ‚Üí Service (Kafka Events)</h3>
                <p>Services publish events to Kafka for async communication:</p>
                <ul>
                    <li><code>orders.created</code> - When orders are created</li>
                    <li><code>orders.updated</code> - When orders are updated</li>
                    <li><code>orders.deleted</code> - When orders are deleted</li>
                    <li><code>services.heartbeat</code> - Service health status</li>
                </ul>
                <p>Other services can consume these events to react to changes without direct HTTP calls.</p>
                
                <h2>Health Checks</h2>
                <p>All services are automatically included in the gateway health check with hybrid Kafka/HTTP approach:</p>
                <pre><code>GET /api/health</code></pre>
                <p>Response includes:</p>
                <ul>
                    <li>Gateway status</li>
                    <li>All service statuses (from Kafka heartbeats or HTTP fallback)</li>
                    <li>Response times</li>
                    <li>Service URLs and descriptions</li>
                    <li>Kafka status indicator</li>
                </ul>
                
                <h3>Health Check Strategy</h3>
                <p>The gateway uses a <strong>hybrid approach</strong>:</p>
                <ol>
                    <li><strong>Primary:</strong> Attempts to get service status via Kafka heartbeat events</li>
                    <li><strong>Fallback:</strong> If Kafka is unavailable or no recent heartbeat, falls back to HTTP health check</li>
                </ol>
                <p>This ensures reliability even if Kafka is temporarily unavailable.</p>
                
                <h2>Development Tools</h2>
                
                <h3>Artisan Commands</h3>
                <pre><code># List all registered services
php artisan gateway:services

# Show details for a specific service
php artisan gateway:service {name}</code></pre>
                
                <h3>Service Template</h3>
                <p>Use <code>gateway-service/SERVICE-TEMPLATE.php</code> as a starting point for new services.</p>
                
                <h2>Best Practices</h2>
                <ol>
                    <li><strong>Use Environment Variables</strong>: Always use env vars for service URLs</li>
                    <li><strong>Descriptive Names</strong>: Use clear, descriptive service names</li>
                    <li><strong>RESTful Routes</strong>: Follow REST conventions for route paths</li>
                    <li><strong>Health Endpoints</strong>: Always implement health check endpoints</li>
                    <li><strong>Error Handling</strong>: Implement proper error handling in services</li>
                    <li><strong>Logging</strong>: Use consistent logging across services</li>
                    <li><strong>Documentation</strong>: Document your service in the configuration</li>
                </ol>
                
                <h2>Security</h2>
                <ul>
                    <li><strong>JWT Authentication</strong>: All protected routes require valid JWT tokens</li>
                    <li><strong>Role-Based Access</strong>: Routes can require specific roles</li>
                    <li><strong>Gateway Trust</strong>: Services trust the gateway via <code>TrustGateway</code> middleware</li>
                    <li><strong>Bypass Mode</strong>: Development mode for local testing (never use in production)</li>
                </ul>
                
                <h2>Scalability</h2>
                <p>The architecture supports:</p>
                <ul>
                    <li><strong>Horizontal Scaling</strong>: Add multiple instances of services</li>
                    <li><strong>Service Isolation</strong>: Each service is independent</li>
                    <li><strong>Dynamic Registration</strong>: Add services without code changes</li>
                    <li><strong>Load Balancing</strong>: Gateway can be load balanced</li>
                    <li><strong>Service Discovery</strong>: Easy to integrate with service discovery systems</li>
                </ul>
                
                <h2>Current Infrastructure</h2>
                <ul>
                    <li>‚úÖ 5 Microservices: Users, Orders, Products, Carts, Payments</li>
                    <li>‚úÖ Apache Kafka for event-driven communication</li>
                    <li>‚úÖ Kafka UI for monitoring and debugging</li>
                    <li>‚úÖ Hybrid health checks (Kafka + HTTP fallback)</li>
                    <li>‚úÖ Event publishing for async operations</li>
                    <li>‚úÖ Next.js Frontend with modern UI/UX</li>
                    <li>‚úÖ SweetAlert2 for enhanced user notifications</li>
                    <li>‚úÖ Complete eCommerce functionality</li>
                    <li>‚úÖ Database seeding with test data</li>
                    <li>‚úÖ Automated setup script with multiple options</li>
                </ul>
                
                <h2>Future Enhancements</h2>
                <p>Potential improvements:</p>
                <ul>
                    <li>Full Kafka consumer implementation for event processing</li>
                    <li>Service discovery via Consul/etcd</li>
                    <li>Circuit breakers for resilience</li>
                    <li>Request/response caching</li>
                    <li>Rate limiting per service</li>
                    <li>API versioning</li>
                    <li>GraphQL gateway support</li>
                    <li>WebSocket support</li>
                    <li>Kafka queue driver for Laravel queues</li>
                </ul>
            </section>
            
            <!-- API Endpoints Section -->
            <section id="api">
                <h1>API Endpoints</h1>
                
                <div class="alert alert-info">
                    <strong>üìç Base URL:</strong> All API endpoints are accessed through the Gateway at <code>http://localhost:8000/api</code>
                </div>
                
                <h2>Authentication</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/auth/register</code></td>
                            <td>Public</td>
                            <td>Register new user</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/auth/login</code></td>
                            <td>Public</td>
                            <td>Login user</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/auth/refresh</code></td>
                            <td>Public</td>
                            <td>Refresh JWT token</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/auth/logout</code></td>
                            <td>Public</td>
                            <td>Logout user</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Users</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/users/profile</code></td>
                            <td>Required</td>
                            <td>Get current user profile</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/users/profile</code></td>
                            <td>Required</td>
                            <td>Update current user profile</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/users</code></td>
                            <td>Admin</td>
                            <td>List all users</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/users/{id}</code></td>
                            <td>Admin</td>
                            <td>Get user by ID</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/users/{id}</code></td>
                            <td>Admin</td>
                            <td>Update user</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">DELETE</span></td>
                            <td><code>/api/users/{id}</code></td>
                            <td>Admin</td>
                            <td>Delete user</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Products</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/products</code></td>
                            <td>Public</td>
                            <td>List products (supports: category, status, search, min_price, max_price)</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/products/{id}</code></td>
                            <td>Public</td>
                            <td>Get product details</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/products</code></td>
                            <td>Required</td>
                            <td>Create new product</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/products/{id}</code></td>
                            <td>Required</td>
                            <td>Update product</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">DELETE</span></td>
                            <td><code>/api/products/{id}</code></td>
                            <td>Required</td>
                            <td>Delete product</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Carts</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/carts</code></td>
                            <td>Required</td>
                            <td>Get user's cart</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/carts/items</code></td>
                            <td>Required</td>
                            <td>Add item to cart</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/carts/items/{itemId}</code></td>
                            <td>Required</td>
                            <td>Update cart item quantity</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">DELETE</span></td>
                            <td><code>/api/carts/items/{itemId}</code></td>
                            <td>Required</td>
                            <td>Remove item from cart</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">DELETE</span></td>
                            <td><code>/api/carts</code></td>
                            <td>Required</td>
                            <td>Clear entire cart</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Orders</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/orders</code></td>
                            <td>Required</td>
                            <td>Get user's orders</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/orders</code></td>
                            <td>Required</td>
                            <td>Create new order</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/orders/{id}</code></td>
                            <td>Required</td>
                            <td>Get order details</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/orders/{id}</code></td>
                            <td>Required</td>
                            <td>Update order</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">DELETE</span></td>
                            <td><code>/api/orders/{id}</code></td>
                            <td>Required</td>
                            <td>Cancel order</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/orders/admin/all</code></td>
                            <td>Moderator+</td>
                            <td>Get all orders (admin)</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/orders/{id}/status</code></td>
                            <td>Moderator+</td>
                            <td>Update order status</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Payments</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/payments</code></td>
                            <td>Required</td>
                            <td>Get user's payments</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">POST</span></td>
                            <td><code>/api/payments</code></td>
                            <td>Required</td>
                            <td>Create payment</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/payments/{id}</code></td>
                            <td>Required</td>
                            <td>Get payment details</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">PUT</span></td>
                            <td><code>/api/payments/{id}/status</code></td>
                            <td>Required</td>
                            <td>Update payment status</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Health Check</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td><code>/api/health</code></td>
                            <td>Public</td>
                            <td>Check gateway and all services health status</td>
                        </tr>
                    </tbody>
                </table>
                
                <h2>Authentication</h2>
                <p>For authenticated endpoints, include the JWT token in the Authorization header:</p>
                <pre><code>Authorization: Bearer {your-jwt-token}</code></pre>
                
                <h2>Response Format</h2>
                <p>All API responses follow a consistent format:</p>
                <pre><code>// Success Response
{
    "data": { ... },
    "message": "Success message"
}

// Error Response
{
    "error": "Error message",
    "errors": { ... }  // Validation errors
}</code></pre>
                
                <h2>Quick Links</h2>
                <ul>
                    <li><strong>Gateway URL:</strong> <code>http://localhost:8000</code></li>
                    <li><strong>API Base:</strong> <code>http://localhost:8000/api</code></li>
                    <li><strong>Health Check:</strong> <code>http://localhost:8000/api/health</code></li>
                    <li><strong>Frontend:</strong> <code>http://localhost:3000</code></li>
                </ul>
            </section>
            
            <!-- Frontend Section -->
            <section id="frontend">
                <h1>Frontend Application</h1>
                
                <h2>Overview</h2>
                <p>The project includes a modern Next.js frontend application with beautiful UI/UX, built with React 19, TypeScript, and TailwindCSS.</p>
                
                <h2>Technology Stack</h2>
                <ul>
                    <li><strong>Next.js 16</strong> - React framework with App Router</li>
                    <li><strong>React 19</strong> - UI library</li>
                    <li><strong>TypeScript</strong> - Type safety</li>
                    <li><strong>TailwindCSS 4</strong> - Utility-first CSS framework</li>
                    <li><strong>SweetAlert2</strong> - Beautiful alert dialogs</li>
                </ul>
                
                <h2>Features</h2>
                
                <h3>Pages</h3>
                <ul>
                    <li>üè† <strong>Home</strong> - Product catalog with search and filters</li>
                    <li>üîê <strong>Authentication</strong> - Login and Registration</li>
                    <li>üõçÔ∏è <strong>Products</strong> - Product listing and detail pages</li>
                    <li>üõí <strong>Shopping Cart</strong> - Cart management</li>
                    <li>üí≥ <strong>Checkout</strong> - Complete checkout process</li>
                    <li>üì¶ <strong>Orders</strong> - Order history and details</li>
                    <li>üë§ <strong>Profile</strong> - User profile management</li>
                </ul>
                
                <h3>UI/UX Features</h3>
                <ul>
                    <li>‚ú® Modern design with gradients and animations</li>
                    <li>üé® SweetAlert2 notifications (replaces browser alerts)</li>
                    <li>‚ö° Loading states with spinners</li>
                    <li>üéØ Confirmation dialogs for destructive actions</li>
                    <li>üì± Fully responsive design</li>
                    <li>üé≠ Error boundaries for graceful error handling</li>
                    <li>üîÑ Real-time cart updates</li>
                    <li>üí∞ Price formatting with currency support</li>
                </ul>
                
                <h2>Setup</h2>
                <pre><code>cd frontend
npm install
npm run dev</code></pre>
                <p>The frontend will be available at <code>http://localhost:3000</code></p>
                
                <h2>API Integration</h2>
                <p>The frontend communicates with the backend through the API Gateway at <code>http://localhost:8000/api</code>. All API calls are handled through a centralized API client with proper error handling and authentication.</p>
                
                <h2>Authentication Flow</h2>
                <ol>
                    <li>User logs in via <code>/api/auth/login</code></li>
                    <li>JWT token is stored in localStorage</li>
                    <li>Token is automatically included in all authenticated requests</li>
                    <li>Token is refreshed automatically when needed</li>
                </ol>
                
                <h2>Key Components</h2>
                <ul>
                    <li><code>AuthContext</code> - Authentication state management</li>
                    <li><code>ErrorBoundary</code> - Catches and displays errors gracefully</li>
                    <li><code>ProductCard</code> - Reusable product display component</li>
                    <li><code>Header</code> - Navigation header</li>
                    <li><code>Footer</code> - Site footer</li>
                </ul>
            </section>
            
            <!-- Structure Improvements Section -->
            <section id="structure">
                <h1>Microservices Structure Improvements</h1>
                
                <h2>Summary</h2>
                <p>The microservices architecture has been restructured to make adding new services <strong>extremely easy</strong>. The system is now configuration-driven, meaning you can add new services by simply editing a configuration file instead of modifying code.</p>
                
                <h2>Recent Structure Changes</h2>
                
                <div class="alert alert-info">
                    <strong>üìÅ Docker Configuration Reorganization:</strong> All Docker-related files have been moved to the <code>docker/</code> folder. The root directory now only contains <code>setup.sh</code>.
                </div>
                
                <h3>New Folder Structure</h3>
                <ul>
                    <li><code>docker/docker-compose.yml</code> - Docker Compose configuration</li>
                    <li><code>docker/.env</code> - Docker environment variables (created by setup.sh)</li>
                    <li><code>docker/k8s/</code> - Kubernetes manifests</li>
                    <li><code>setup.sh</code> - Setup script (root directory)</li>
                </ul>
                
                <h2>What Changed</h2>
                
                <h3>1. Service Registry System</h3>
                <p><strong>New File</strong>: <code>gateway-service/app/Services/ServiceRegistry.php</code></p>
                <ul>
                    <li>Centralized service management</li>
                    <li>Dynamic service discovery</li>
                    <li>Easy service lookup and validation</li>
                </ul>
                
                <h3>2. Configuration-Driven Routes</h3>
                <p><strong>New File</strong>: <code>gateway-service/app/Services/RouteConfig.php</code></p>
                <ul>
                    <li>Automatic route registration from configuration</li>
                    <li>Routes grouped by middleware for efficiency</li>
                    <li>Dynamic parameter forwarding</li>
                </ul>
                
                <h3>3. Enhanced Services Configuration</h3>
                <p><strong>Updated</strong>: <code>gateway-service/config/services.php</code></p>
                <ul>
                    <li>Structured service definitions for all 5 services</li>
                    <li>Route definitions with middleware</li>
                    <li>Health check endpoints</li>
                    <li>Service descriptions</li>
                </ul>
                
                <h3>4. Simplified Routes File</h3>
                <p><strong>Updated</strong>: <code>gateway-service/routes/api.php</code></p>
                <ul>
                    <li>Reduced from 116 lines to 26 lines</li>
                    <li>All routes now auto-registered from config</li>
                    <li>No need to manually add routes for new services</li>
                </ul>
                
                <h3>5. Enhanced Gateway Controller</h3>
                <p><strong>Updated</strong>: <code>gateway-service/app/Http/Controllers/GatewayController.php</code></p>
                <ul>
                    <li>Uses ServiceRegistry instead of hardcoded services</li>
                    <li>Better error messages</li>
                    <li>Improved health check with service descriptions</li>
                </ul>
                
                <h3>6. Artisan Commands</h3>
                <p><strong>Updated</strong>: <code>gateway-service/routes/console.php</code></p>
                <ul>
                    <li><code>php artisan gateway:services</code> - List all registered services</li>
                    <li><code>php artisan gateway:service {name}</code> - Show service details</li>
                </ul>
                
                <h3>7. Database Seeding</h3>
                <p><strong>New</strong>: All services now have database seeders</p>
                <ul>
                    <li>Test users with different roles</li>
                    <li>Sample products across categories</li>
                    <li>Sample orders with various statuses</li>
                    <li>Sample carts with items</li>
                    <li>Sample payment records</li>
                </ul>
                
                <h3>8. Unified Setup Script</h3>
                <p><strong>Updated</strong>: <code>setup.sh</code> now includes all setup operations</p>
                <ul>
                    <li>Full setup option (Docker + migrations + seeding)</li>
                    <li>Database fixing option (recreate databases + migrations + seeding)</li>
                    <li>Database seeding option (seed all services with test data)</li>
                </ul>
                
                <h2>Benefits</h2>
                
                <h3>Before (Old Structure)</h3>
                <p>To add a new service, you had to:</p>
                <ol>
                    <li>Edit <code>GatewayController.php</code> to add service URL</li>
                    <li>Manually add routes in <code>routes/api.php</code></li>
                    <li>Update health check logic</li>
                    <li>Update catch-all route pattern</li>
                    <li>Test everything manually</li>
                </ol>
                
                <h3>After (New Structure)</h3>
                <p>To add a new service, you only need to:</p>
                <ol>
                    <li>Add service configuration to <code>config/services.php</code></li>
                    <li>Set environment variable</li>
                    <li><strong>Done!</strong> Routes are auto-registered</li>
                </ol>
                
                <div class="alert alert-success">
                    <strong>‚úÖ All Services Already Configured:</strong> Products, Carts, and Payments services are already fully configured and working!
                </div>
                
                <h2>Example: Adding a New Service</h2>
                
                <h3>Step 1: Add to <code>config/services.php</code></h3>
                <pre><code>'new-service' => [
    'url' => env('NEW_SERVICE_URL', 'http://localhost:8006'),
    'health_endpoint' => '/api/health',
    'description' => 'New service description',
    'routes' => [
        [
            'path' => 'new-service',
            'service_path' => 'api/',
            'methods' => ['GET', 'POST'],
            'middleware' => ['gateway.auth'],
        ],
        // ... more routes
    ],
],</code></pre>
                
                <h3>Step 2: Add to <code>.env</code></h3>
                <pre><code>NEW_SERVICE_URL=http://localhost:8006</code></pre>
                
                <h3>Step 3: Done!</h3>
                <p>The gateway automatically:</p>
                <ul>
                    <li>‚úÖ Registers all routes</li>
                    <li>‚úÖ Includes in health checks</li>
                    <li>‚úÖ Enables dynamic routing</li>
                    <li>‚úÖ Applies middleware correctly</li>
                </ul>
                
                <h2>Files Created</h2>
                <ol>
                    <li><code>gateway-service/app/Services/ServiceRegistry.php</code> - Service registry</li>
                    <li><code>gateway-service/app/Services/RouteConfig.php</code> - Route configuration</li>
                    <li><code>gateway-service/README-SERVICES.md</code> - Service addition guide</li>
                    <li><code>gateway-service/SERVICE-TEMPLATE.php</code> - Service template</li>
                    <li><code>ARCHITECTURE.md</code> - Architecture documentation</li>
                </ol>
                
                <h2>Files Modified</h2>
                <ol>
                    <li><code>gateway-service/config/services.php</code> - Restructured with microservices config</li>
                    <li><code>gateway-service/routes/api.php</code> - Simplified to use RouteConfig</li>
                    <li><code>gateway-service/app/Http/Controllers/GatewayController.php</code> - Uses ServiceRegistry</li>
                    <li><code>gateway-service/routes/console.php</code> - Added service management commands</li>
                    <li><code>README.md</code> - Added reference to new structure</li>
                </ol>
                
                <h2>Backward Compatibility</h2>
                <div class="alert alert-success">
                    <strong>‚úÖ Fully backward compatible</strong>
                    <ul>
                        <li>All existing routes still work</li>
                        <li>No breaking changes to API</li>
                        <li>Existing services continue to function</li>
                        <li>Health checks work as before</li>
                    </ul>
                </div>
                
                <h2>Testing</h2>
                <p>Test the new structure:</p>
                <pre><code># List all services
php artisan gateway:services

# Check specific service
php artisan gateway:service users

# Test health endpoint
curl http://localhost:8000/api/health</code></pre>
            </section>
            
            <!-- Environment Configuration Section -->
            <section id="environment">
                <h1>Environment Configuration Guide</h1>
                
                <div class="alert alert-info">
                    <strong>üìÅ New Structure:</strong> All Docker-related configuration is now in the <code>docker/</code> folder. The root directory only contains <code>setup.sh</code>.
                </div>
                
                <h2>Quick Start</h2>
                <ol>
                    <li>Run <code>./setup.sh</code> (Linux/Mac/Windows Git Bash) - it provides three options:
                        <ul>
                            <li><strong>Option 1 - Full Setup:</strong> Complete Docker/K8s deployment with migrations and seeding</li>
                            <li><strong>Option 2 - Fix Databases:</strong> Recreate databases, run migrations, and seed data</li>
                            <li><strong>Option 3 - Seed All Databases:</strong> Seed all microservices with test data</li>
                        </ul>
                    </li>
                    <li>The script automatically:
                        <ul>
                            <li>Creates <code>docker/.env</code> with default values</li>
                            <li>Builds Docker images</li>
                            <li>Starts all services (including Kafka, MySQL, Redis)</li>
                            <li>Runs database migrations for all services</li>
                            <li>Seeds databases with test data</li>
                        </ul>
                    </li>
                    <li>For Docker: Environment variables are set in <code>docker/docker-compose.yml</code> (references <code>docker/.env</code>)</li>
                    <li>For local development: Copy <code>local_env</code> to <code>.env</code> in each service directory</li>
                </ol>
                
                <div class="alert alert-success">
                    <strong>‚úÖ Automated Setup:</strong> The <code>setup.sh</code> script handles everything automatically. No manual configuration needed for Docker deployment!
                </div>
                
                <div class="alert alert-info">
                    <strong>üìä Test Data:</strong> The setup script automatically seeds all databases with test data including users, products, orders, carts, and payments for easy testing.
                </div>
                
                <h2>Docker Environment Configuration</h2>
                
                <div class="alert alert-success">
                    <strong>‚úÖ New Structure:</strong> All services now use <code>.production_env</code> files for Docker deployment. Environment variables are no longer hardcoded in <code>docker-compose.yml</code>.
                </div>
                
                <h3>Production Environment Files</h3>
                <p>Each service has a <code>.production_env</code> file that contains all production settings:</p>
                <ul>
                    <li><code>gateway-service/.production_env</code> - Gateway service configuration</li>
                    <li><code>users-service/.production_env</code> - Users service configuration</li>
                    <li><code>orders-service/.production_env</code> - Orders service configuration</li>
                    <li><code>product-service/.production_env</code> - Product service configuration</li>
                    <li><code>cart-service/.production_env</code> - Cart service configuration</li>
                    <li><code>payment-service/.production_env</code> - Payment service configuration</li>
                </ul>
                
                <p><strong>Benefits:</strong></p>
                <ul>
                    <li>‚úÖ All settings centralized in one file per service</li>
                    <li>‚úÖ No hardcoded values in docker-compose.yml</li>
                    <li>‚úÖ Easier to manage and update</li>
                    <li>‚úÖ Cleaner docker-compose.yml file</li>
                </ul>
                
                <h3>Docker Compose Environment File</h3>
                <p><strong>File</strong>: <code>docker/.env</code> (created automatically by <code>setup.sh</code>)</p>
                <p>This file is used for Docker Compose-specific variables (MySQL passwords, JWT secrets, etc.):</p>
                <pre><code># Application Environment
APP_ENV=production
APP_DEBUG=false

# MySQL Configuration
MYSQL_ROOT_PASSWORD=rootpassword
MYSQL_DATABASE=microservices
MYSQL_USER=microservice_user
MYSQL_PASSWORD=microservice_pass

# JWT Secret
JWT_SECRET=your-secret-key-change-this-in-production

# Gateway Configuration
GATEWAY_MODE=introspect
GATEWAY_BYPASS_ROLE=admin
GATEWAY_BYPASS_EMAIL=dev@example.com</code></pre>
                
                <p><strong>Note:</strong> Docker Compose uses <code>env_file</code> directive to load environment variables from <code>.production_env</code> files. The <code>docker/.env</code> file is only used for Docker Compose variable substitution.</p>
                
                <h2>Local Development Environment Variables</h2>
                
                <h3>Gateway Service</h3>
                <p><strong>File</strong>: <code>gateway-service/.env</code> or <code>gateway-service/local_env</code></p>
                <pre><code># Application
APP_URL=${GATEWAY_URL:-http://localhost:8000}
GATEWAY_URL=http://localhost:8000
GATEWAY_HOST=localhost
GATEWAY_PORT=8000

# Service URLs
USERS_SERVICE_URL=http://localhost:8001
ORDERS_SERVICE_URL=http://localhost:8002
AUTH_SERVICE_URL=${USERS_SERVICE_URL}

# Gateway Configuration
GATEWAY_MODE=introspect  # or 'bypass' for development
GATEWAY_BYPASS_ROLE=admin
GATEWAY_BYPASS_EMAIL=dev@example.com
GATEWAY_TIMEOUT=3.0
GATEWAY_PROXY_TIMEOUT=30
GATEWAY_CONNECT_TIMEOUT=5

# JWT
JWT_SECRET=your-secret-key-change-this-in-production</code></pre>
                
                <h3>Users Service</h3>
                <p><strong>File</strong>: <code>users-service/.env</code> or <code>users-service/local_env</code></p>
                <pre><code># Application
APP_URL=${USERS_SERVICE_URL:-http://localhost:8001}
USERS_SERVICE_URL=http://localhost:8001
USERS_SERVICE_HOST=localhost
USERS_SERVICE_PORT=8001

# JWT
JWT_SECRET=your-secret-key-change-this-in-production</code></pre>
                
                <h3>Orders Service</h3>
                <p><strong>File</strong>: <code>orders-service/.env</code> or <code>orders-service/local_env</code></p>
                <pre><code># Application
APP_URL=${ORDERS_SERVICE_URL:-http://localhost:8002}
ORDERS_SERVICE_URL=http://localhost:8002
ORDERS_SERVICE_HOST=localhost
ORDERS_SERVICE_PORT=8002

# JWT
JWT_SECRET=your-secret-key-change-this-in-production</code></pre>
                
                <h2>Production Configuration</h2>
                
                <h3>For Production Deployment</h3>
                <ol>
                    <li><strong>Set APP_ENV to production</strong>:
                        <pre><code>APP_ENV=production
APP_DEBUG=false</code></pre>
                    </li>
                    <li><strong>Use production URLs</strong>:
                        <pre><code>GATEWAY_URL=https://api.yourdomain.com
USERS_SERVICE_URL=https://users.yourdomain.com
ORDERS_SERVICE_URL=https://orders.yourdomain.com</code></pre>
                    </li>
                    <li><strong>Use strong JWT secret</strong>:
                        <pre><code>JWT_SECRET=your-very-strong-random-secret-key-here</code></pre>
                    </li>
                    <li><strong>Configure database</strong>:
                        <pre><code>DB_CONNECTION=mysql
DB_HOST=your-db-host
DB_DATABASE=your-database
DB_USERNAME=your-username
DB_PASSWORD=your-password</code></pre>
                    </li>
                    <li><strong>Set gateway mode to introspect</strong>:
                        <pre><code>GATEWAY_MODE=introspect</code></pre>
                    </li>
                </ol>
                
                <h2>Configuration Priority</h2>
                <p>The system uses the following priority order:</p>
                <ol>
                    <li><strong>Docker Environment</strong>: Variables from <code>docker-compose.yml</code> (when running in Docker)</li>
                    <li><strong>Environment Variables</strong>: <code>.env</code> file (for local development)</li>
                    <li><strong>Configuration Files</strong>: <code>config/*.php</code></li>
                    <li><strong>Default Values</strong>: Fallback values in code</li>
                </ol>
                
                <h2>Service Discovery</h2>
                <p>All service URLs are configured in:</p>
                <ul>
                    <li><code>gateway-service/config/services.php</code> - Uses env variables</li>
                    <li><code>docker/docker-compose.yml</code> - Uses <code>env_file</code> to load from <code>.production_env</code> files</li>
                    <li><code>docker/.env</code> - Docker Compose environment file (created by setup.sh) - for MySQL, JWT secrets, etc.</li>
                    <li><code>service-name/.production_env</code> - Production environment variables for each service (used by Docker)</li>
                    <li><code>service-name/local_env</code> - Local development template (copy to <code>.env</code> for local dev)</li>
                </ul>
                
                <div class="alert alert-info">
                    <strong>üìù Environment File Structure:</strong>
                    <ul>
                        <li><strong>Docker/Production:</strong> Uses <code>.production_env</code> files (loaded via <code>env_file</code> in docker-compose.yml)</li>
                        <li><strong>Local Development:</strong> Copy <code>local_env</code> to <code>.env</code> in each service directory</li>
                        <li><strong>Docker Compose Variables:</strong> <code>docker/.env</code> for MySQL passwords, JWT secrets, etc.</li>
                    </ul>
                </div>
                
                <h2>Testing with Custom URLs</h2>
                <p>Update <code>test.php</code> will automatically read from environment files:</p>
                <pre><code># Set environment variables
export GATEWAY_URL=http://192.168.1.100:8000
export USERS_SERVICE_URL=http://192.168.1.100:8001
export ORDERS_SERVICE_URL=http://192.168.1.100:8002

# Or update local_env files directly</code></pre>
                
                <h2>Docker/Container Configuration</h2>
                <p>For containerized deployments, environment variables are loaded from <code>.production_env</code> files:</p>
                <pre><code># docker/docker-compose.yml
services:
  gateway:
    env_file:
      - ./gateway-service/.production_env
    # No hardcoded environment variables!
    
  users:
    env_file:
      - ./users-service/.production_env
      
  orders:
    env_file:
      - ./orders-service/.production_env</code></pre>
                
                <p><strong>Important:</strong> All environment variables are now in <code>.production_env</code> files. The <code>docker/.env</code> file is only used for Docker Compose variable substitution (MySQL passwords, etc.).</p>
                
                <h2>Network Configuration</h2>
                
                <h2>Service URLs</h2>
                
                <h3>Docker Services (Default)</h3>
                <ul>
                    <li><strong>Gateway:</strong> http://localhost:8000</li>
                    <li><strong>Users Service:</strong> http://localhost:8001</li>
                    <li><strong>Orders Service:</strong> http://localhost:8002</li>
                    <li><strong>Product Service:</strong> http://localhost:8003</li>
                    <li><strong>Cart Service:</strong> http://localhost:8004</li>
                    <li><strong>Payment Service:</strong> http://localhost:8005</li>
                    <li><strong>MySQL:</strong> localhost:3306</li>
                    <li><strong>Redis:</strong> localhost:6379</li>
                    <li><strong>Kafka:</strong> localhost:9092</li>
                    <li><strong>Kafka UI:</strong> http://localhost:8081</li>
                    <li><strong>Zookeeper:</strong> localhost:2181</li>
                    <li><strong>phpMyAdmin:</strong> http://localhost:8080</li>
                </ul>
                
                <h3>Network Configuration</h3>
                
                <h4>Local Development</h4>
                <pre><code>GATEWAY_URL=http://localhost:8000
USERS_SERVICE_URL=http://localhost:8001
ORDERS_SERVICE_URL=http://localhost:8002
KAFKA_BROKERS=localhost:9092</code></pre>
                
                <h4>Docker Network (Inside Containers)</h4>
                <pre><code>GATEWAY_URL=http://gateway:8000
USERS_SERVICE_URL=http://users:8001
ORDERS_SERVICE_URL=http://orders:8002
KAFKA_BROKERS=kafka:29092</code></pre>
                
                <h4>LAN Access</h4>
                <pre><code>GATEWAY_URL=http://192.168.1.100:8000
USERS_SERVICE_URL=http://192.168.1.100:8001
ORDERS_SERVICE_URL=http://192.168.1.100:8002
KAFKA_BROKERS=192.168.1.100:9092</code></pre>
                
                <h4>Production</h4>
                <pre><code>GATEWAY_URL=https://api.example.com
USERS_SERVICE_URL=https://users.example.com
ORDERS_SERVICE_URL=https://orders.example.com
KAFKA_BROKERS=kafka.example.com:9092</code></pre>
                
                <h2>Timeout Configuration</h2>
                <p>Configure timeouts for production:</p>
                <pre><code># Gateway timeout for introspection
GATEWAY_TIMEOUT=3.0

# Proxy timeout for forwarding requests
GATEWAY_PROXY_TIMEOUT=30

# Connection timeout
GATEWAY_CONNECT_TIMEOUT=5</code></pre>
                
                <h2>Security Notes</h2>
                <ol>
                    <li><strong>Never commit <code>.env</code> files</strong> - They contain sensitive information</li>
                    <li><strong>Use different JWT secrets</strong> in production</li>
                    <li><strong>Set APP_DEBUG=false</strong> in production</li>
                    <li><strong>Use HTTPS</strong> in production</li>
                    <li><strong>Set strong passwords</strong> for database connections</li>
                </ol>
                
                <h2>Verification</h2>
                <p>Check your configuration:</p>
                <pre><code># Check Docker services
docker-compose -f docker/docker-compose.yml --project-directory . ps

# Check environment variables in container
docker-compose -f docker/docker-compose.yml --project-directory . exec gateway env | grep APP_

# Gateway service (inside container)
docker-compose -f docker/docker-compose.yml --project-directory . exec gateway php artisan gateway:services</code></pre>
                
                <h2>Troubleshooting</h2>
                
                <h3>Service Not Found</h3>
                <ul>
                    <li>Check that service URL is set in <code>.env</code></li>
                    <li>Verify service is running on configured port</li>
                    <li>Check firewall/network settings</li>
                </ul>
                
                <h3>Connection Timeout</h3>
                <ul>
                    <li>Increase <code>GATEWAY_PROXY_TIMEOUT</code></li>
                    <li>Check network connectivity</li>
                    <li>Verify service URLs are correct</li>
                </ul>
                
                <h3>Configuration Not Loading</h3>
                <ul>
                    <li>Clear config cache: <code>php artisan config:clear</code></li>
                    <li>Restart services after changing <code>.env</code></li>
                    <li>Check file permissions on <code>.env</code> files</li>
                </ul>
            </section>
            
            <!-- Apache Kafka Section -->
            <section id="kafka">
                <h1>Apache Kafka Integration</h1>
                
                <h2>Overview</h2>
                <p>Apache Kafka is integrated into the microservices architecture for <strong>event-driven asynchronous communication</strong>. This enables decoupled, scalable, and reliable communication between services.</p>
                
                <h2>Architecture</h2>
                <p>The system uses a <strong>hybrid approach</strong>:</p>
                <ul>
                    <li><strong>Kafka</strong>: For async event-driven operations (order events, heartbeats, etc.)</li>
                    <li><strong>HTTP</strong>: For synchronous request/response (API routing, JWT validation)</li>
                </ul>
                
                <h2>Kafka Services</h2>
                <ul>
                    <li><strong>Zookeeper</strong> (Port 2181): Coordination service for Kafka</li>
                    <li><strong>Kafka Broker</strong> (Port 9092): Main message broker</li>
                    <li><strong>Kafka UI</strong> (Port 8081): Web interface for monitoring topics and messages</li>
                </ul>
                
                <h2>What Kafka Replaces</h2>
                
                <h3>‚úÖ Replaced with Kafka:</h3>
                <ol>
                    <li><strong>Direct Service Calls for Async Operations</strong>
                        <ul>
                            <li>OrderService publishes events instead of making direct HTTP calls</li>
                            <li>Events: <code>orders.created</code>, <code>orders.updated</code>, <code>orders.deleted</code></li>
                        </ul>
                    </li>
                    <li><strong>Health Check Polling</strong>
                        <ul>
                            <li>Services can publish heartbeat events to Kafka</li>
                            <li>Gateway consumes from Kafka (with HTTP fallback for reliability)</li>
                        </ul>
                    </li>
                </ol>
                
                <h3>‚ùå Still Using HTTP (Correctly):</h3>
                <ul>
                    <li>Gateway request routing (needs synchronous responses)</li>
                    <li>JWT token validation (security requires immediate validation)</li>
                    <li>Health check HTTP fallback (reliability if Kafka unavailable)</li>
                </ul>
                
                <h2>Event Topics</h2>
                
                <h3>Order Events</h3>
                <ul>
                    <li><code>orders.created</code> - Published when order is created</li>
                    <li><code>orders.updated</code> - Published when order status changes</li>
                    <li><code>orders.deleted</code> - Published when order is deleted</li>
                </ul>
                
                <h3>Service Events (Ready for Implementation)</h3>
                <ul>
                    <li><code>services.heartbeat</code> - For health check heartbeats</li>
                    <li><code>users.created</code> - When user registers</li>
                    <li><code>users.updated</code> - When user profile updates</li>
                </ul>
                
                <h2>Using Kafka in Services</h2>
                
                <h3>Publishing Events</h3>
                <pre><code>use App\Services\KafkaService;

class OrderService
{
    public function __construct(
        private ?KafkaService $kafka = null
    ) {
        if ($this->kafka === null) {
            $this->kafka = app(KafkaService::class);
        }
    }
    
    public function createForUser(int $userId, array $data): Order
    {
        $order = Order::create([...]);
        
        // Publish event to Kafka
        if ($this->kafka) {
            $this->kafka->publish('orders.created', [
                'order_id' => $order->id,
                'order_number' => $order->order_number,
                'user_id' => $order->user_id,
                'status' => $order->status,
                'total_amount' => $order->total_amount,
                'created_at' => $order->created_at->toIso8601String(),
            ], "order_{$order->id}");
        }
        
        return $order;
    }
}</code></pre>
                
                <h3>Consuming Events</h3>
                <pre><code>use App\Services\KafkaService;

// In a service or queue worker
$kafka = app(KafkaService::class);

$kafka->consume('orders.created', function (array $payload) {
    // Handle the event
    Log::info('Order created event received', $payload);
    // Process the event...
});</code></pre>
                
                <h2>Benefits</h2>
                <ol>
                    <li><strong>Decoupling</strong>: Services communicate via events, not direct HTTP calls</li>
                    <li><strong>Performance</strong>: Async processing doesn't block request/response cycle</li>
                    <li><strong>Reliability</strong>: Events are persisted, can be replayed if service fails</li>
                    <li><strong>Scalability</strong>: Multiple consumers can process same events independently</li>
                    <li><strong>Observability</strong>: All events visible in Kafka UI (http://localhost:8081)</li>
                </ol>
                
                <h2>Kafka UI</h2>
                <p>Access Kafka UI at <strong>http://localhost:8081</strong> to:</p>
                <ul>
                    <li>View all topics and messages</li>
                    <li>Monitor consumer groups</li>
                    <li>Inspect event payloads</li>
                    <li>Debug event flow</li>
                </ul>
                
                <h2>Configuration</h2>
                <p>Kafka is configured in <code>docker/docker-compose.yml</code>:</p>
                <pre><code>kafka:
  image: confluentinc/cp-kafka:7.5.0
  environment:
    KAFKA_BROKER_ID: 1
    KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,PLAINTEXT_INTERNAL://kafka:29092
    KAFKA_AUTO_CREATE_TOPICS_ENABLE: 'true'
    # ... more config</code></pre>
                
                <p>Services connect to Kafka using:</p>
                <pre><code>KAFKA_BROKERS=kafka:29092  # Inside Docker network
KAFKA_BROKERS=localhost:9092  # From host machine</code></pre>
                
                <h2>Health Check Integration</h2>
                <p>The gateway health check uses a hybrid approach:</p>
                <ol>
                    <li>First attempts to get service status via Kafka heartbeats</li>
                    <li>Falls back to HTTP health check if Kafka is unavailable</li>
                </ol>
                <p>This ensures the gateway can still report service health even if Kafka is temporarily down.</p>
            </section>
            
            <!-- Adding Services Section -->
            <section id="services">
                <h1>Adding New Microservices</h1>
                
                <p>This guide explains how to easily add new microservices to your gateway without modifying code.</p>
                
                <h2>Quick Start: Adding a New Service</h2>
                <p>To add a new microservice, simply edit <code>config/services.php</code> and add a new entry to the <code>microservices</code> array.</p>
                
                <h3>Example: Adding a "Products" Service</h3>
                <pre><code>// In gateway-service/config/services.php

'products' => [
    'url' => env('PRODUCTS_SERVICE_URL', 'http://localhost:8003'),
    'health_endpoint' => '/api/health',
    'description' => 'Product catalog service',
    'routes' => [
        // Public routes
        [
            'path' => 'products',
            'service_path' => 'api/products',
            'methods' => ['GET'],
            'middleware' => [],
        ],
        [
            'path' => 'products/{id}',
            'service_path' => 'api/products/{id}',
            'methods' => ['GET'],
            'middleware' => [],
        ],
        // Authenticated routes
        [
            'path' => 'products',
            'service_path' => 'api/products',
            'methods' => ['POST'],
            'middleware' => ['gateway.auth'],
        ],
        [
            'path' => 'products/{id}',
            'service_path' => 'api/products/{id}',
            'methods' => ['PUT', 'DELETE'],
            'middleware' => ['gateway.auth'],
        ],
        // Admin routes
        [
            'path' => 'products/admin/all',
            'service_path' => 'api/admin/products',
            'methods' => ['GET'],
            'middleware' => ['gateway.auth', 'require.role:admin,superadmin'],
        ],
    ],
],</code></pre>
                
                <h2>Step-by-Step Instructions</h2>
                <ol>
                    <li><strong>Add Service Configuration</strong>
                        <ul>
                            <li>Open <code>gateway-service/config/services.php</code></li>
                            <li>Add a new entry to the <code>microservices</code> array</li>
                            <li>Set the service URL (use environment variable for flexibility)</li>
                            <li>Define routes for your service</li>
                        </ul>
                    </li>
                    <li><strong>Set Environment Variable</strong>
                        <ul>
                            <li>For Docker: Add to <code>docker/docker-compose.yml</code> or <code>docker/.env</code>:
                                <pre><code>PRODUCTS_SERVICE_URL=http://products:8003</code></pre>
                            </li>
                            <li>For local development: Add to <code>gateway-service/.env</code>:
                                <pre><code>PRODUCTS_SERVICE_URL=http://localhost:8003</code></pre>
                            </li>
                        </ul>
                    </li>
                    <li><strong>That's it!</strong> The gateway will automatically:
                        <ul>
                            <li>Register all routes</li>
                            <li>Handle request routing</li>
                            <li>Include the service in health checks</li>
                            <li>Support the catch-all dynamic routing</li>
                        </ul>
                    </li>
                </ol>
                
                <h2>Route Configuration</h2>
                <p>Each route in the <code>routes</code> array supports:</p>
                <ul>
                    <li><strong>path</strong>: Gateway path pattern (e.g., <code>products/{id}</code>)</li>
                    <li><strong>service_path</strong>: Path on the target service (e.g., <code>api/products/{id}</code>)</li>
                    <li><strong>methods</strong>: Array of HTTP methods (e.g., <code>['GET', 'POST']</code>)</li>
                    <li><strong>middleware</strong>: Array of middleware to apply (e.g., <code>['gateway.auth']</code>)</li>
                </ul>
                
                <h3>Available Middleware</h3>
                <ul>
                    <li><code>gateway.auth</code> - Requires JWT authentication</li>
                    <li><code>require.role:admin,superadmin</code> - Requires specific roles (comma-separated)</li>
                </ul>
                
                <h3>Route Parameters</h3>
                <p>Route parameters are automatically forwarded. For example:</p>
                <ul>
                    <li>Gateway: <code>products/{id}</code> ‚Üí Service: <code>api/products/{id}</code></li>
                    <li>Request to <code>/api/products/123</code> will forward to service's <code>/api/products/123</code></li>
                </ul>
                
                <h2>Service Registry API</h2>
                <p>You can also programmatically interact with services:</p>
                <pre><code>use App\Services\ServiceRegistry;

// Get all services
$services = ServiceRegistry::all();

// Get a specific service
$service = ServiceRegistry::get('products');

// Get service URL
$url = ServiceRegistry::getUrl('products');

// Check if service exists
if (ServiceRegistry::exists('products')) {
    // Service is registered
}

// Get service routes
$routes = ServiceRegistry::getRoutes('products');</code></pre>
                
                <h2>Dynamic Service Registration</h2>
                <p>You can also register services at runtime:</p>
                <pre><code>use App\Services\ServiceRegistry;

ServiceRegistry::register('new-service', [
    'url' => 'http://localhost:8004',
    'health_endpoint' => '/api/health',
    'description' => 'New service',
    'routes' => [...]
]);</code></pre>
                
                <h2>Health Checks</h2>
                <p>All services are automatically included in the gateway health check endpoint:</p>
                <pre><code>GET /api/health</code></pre>
                <p>Response includes status for all registered services:</p>
                <pre><code>{
    "gateway": "up",
    "services": {
        "users": {
            "status": "up",
            "response_time": 0.023,
            "url": "http://localhost:8001",
            "description": "User management service"
        },
        "orders": {
            "status": "up",
            "response_time": 0.015,
            "url": "http://localhost:8002",
            "description": "Order management service"
        },
        "products": {
            "status": "up",
            "response_time": 0.018,
            "url": "http://localhost:8003",
            "description": "Product catalog service"
        }
    },
    "timestamp": "2025-01-15T10:30:00Z",
    "total_services": 3
}</code></pre>
                
                <h2>Best Practices</h2>
                <ol>
                    <li><strong>Use Environment Variables</strong>: Always use env vars for service URLs
                        <pre><code>'url' => env('PRODUCTS_SERVICE_URL', 'http://localhost:8003'),</code></pre>
                    </li>
                    <li><strong>Group Routes by Middleware</strong>: Routes with the same middleware are automatically grouped for efficiency</li>
                    <li><strong>Use Descriptive Paths</strong>: Make gateway paths intuitive and RESTful</li>
                    <li><strong>Document Your Service</strong>: Add a description to help with debugging</li>
                    <li><strong>Health Endpoints</strong>: Ensure your service has a health check endpoint</li>
                </ol>
                
                <h2>Troubleshooting</h2>
                
                <h3>Service Not Found (404)</h3>
                <ul>
                    <li>Check that the service is registered in <code>config/services.php</code></li>
                    <li>Verify the service name matches exactly</li>
                </ul>
                
                <h3>Service URL Not Configured (500)</h3>
                <ul>
                    <li>Ensure the service URL is set in <code>.env</code></li>
                    <li>Check that the URL is accessible</li>
                </ul>
                
                <h3>Routes Not Working</h3>
                <ul>
                    <li>Verify route paths match your service endpoints</li>
                    <li>Check middleware configuration</li>
                    <li>Ensure HTTP methods are correct</li>
                </ul>
                
                <h3>Health Check Failing</h3>
                <ul>
                    <li>Verify the service is running</li>
                    <li>Check the health endpoint path</li>
                    <li>Ensure the service URL is correct</li>
                </ul>
            </section>
        </div>
        
        <footer>
            <p>&copy; 2025 Laravel 12 JWT Microservices Starter. All rights reserved.</p>
            <p>Complete documentation for microservices architecture, configuration, and service management.</p>
            <p><strong>Last Updated:</strong> January 2025 - Updated with all 5 microservices (Users, Orders, Products, Carts, Payments), database seeding, unified setup script, Next.js frontend with SweetAlert2, and complete API documentation</p>
        </footer>
    </div>
    
    <script>
        // Active navigation highlighting based on scroll position
        (function() {
            const navLinks = document.querySelectorAll('nav a');
            const sections = document.querySelectorAll('section[id]');
            
            function updateActiveNav() {
                let current = '';
                const scrollY = window.pageYOffset || window.scrollY;
                
                // Find the current section based on scroll position
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - 100; // Offset for sticky nav
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.getAttribute('id');
                    
                    if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
                        current = sectionId;
                    }
                });
                
                // Update active class on nav links
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    const href = link.getAttribute('href');
                    if (href === '#' + current) {
                        link.classList.add('active');
                    }
                });
            }
            
            // Update on scroll
            let ticking = false;
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    window.requestAnimationFrame(function() {
                        updateActiveNav();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
            
            // Update on page load
            updateActiveNav();
            
            // Update when clicking nav links (smooth scroll)
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    
                    if (targetSection) {
                        const offsetTop = targetSection.offsetTop - 80; // Offset for sticky nav
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                        
                        // Update active state immediately
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
        })();
    </script>
</body>
</html>
